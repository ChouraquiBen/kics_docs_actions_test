{
  "id": "594c198b-4d79-41b8-9b36-fde13348b619",
  "queryName": "Sensitive Port Is Exposed To Entire Network",
  "severity": "HIGH",
  "category": "Networking and Firewall",
  "descriptionText": "A sensitive port, such as port 23 or port 110, is open for the whole network in either TCP or UDP protocol",
  "descriptionUrl": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule",
  "platform": "Terraform",
  "descriptionID": "a5d60df9",
  "aggregation": 63,
  "cloudProvider": "azure",
  "cwe": "200",
  "detailedDescriptionText": "Exposing sensitive network ports to the entire internet creates significant security vulnerabilities. Sensitive ports like Telnet (23), FTP (21), POP3 (110), IMAP (143), and others run protocols that often transmit data in plaintext or have known security weaknesses. When these ports are accessible from anywhere on the internet (0.0.0.0/0), they become prime targets for attackers seeking unauthorized access, data exfiltration, or service disruption.\n\nVulnerable examples:\n```terraform\n# Allowing Telnet access from anywhere\nresource \"azurerm_network_security_rule\" \"vulnerable1\" {\n  name                        = \"allow-telnet\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"23\"         # Vulnerability: Sensitive Telnet port\n  source_address_prefix       = \"0.0.0.0/0\"  # Vulnerability: Open to any source IP\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n\n# Allowing multiple sensitive ports in a range\nresource \"azurerm_network_security_rule\" \"vulnerable2\" {\n  name                        = \"allow-ports\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"21-25\"      # Vulnerability: Range includes sensitive ports\n  source_address_prefix       = \"/0\"         # Vulnerability: Open to any source IP\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n```\n\nSecure examples:\n```terraform\n# Denying access to sensitive ports from all sources\nresource \"azurerm_network_security_rule\" \"secure1\" {\n  name                        = \"deny-telnet\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Deny\"      # Properly denying access\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"23\"        # Telnet port\n  source_address_prefix       = \"*\"\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n\n# Allowing access to non-sensitive ports only\nresource \"azurerm_network_security_rule\" \"secure2\" {\n  name                        = \"allow-ports\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"8-22, 24-109, 111-142, 144-1023\"\n  source_address_prefix       = \"192.168.1.0/24\"  # Restricted IP range\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n```\n\nMitigation strategies:\n1. Never expose sensitive ports to the public internet (0.0.0.0/0)\n2. Use secure alternatives to legacy protocols (SSH instead of Telnet, SFTP instead of FTP)\n3. If access to these ports is necessary, restrict it to specific trusted IP addresses only\n4. Implement a jump server or bastion host for administrative access\n5. Use Azure Private Link or Service Endpoints where possible\n6. Implement network segmentation to isolate services with sensitive ports\n7. Configure Azure DDoS Protection Standard for additional protection\n8. Use Azure Firewall or Network Virtual Appliances for advanced traffic filtering\n9. Regularly audit security rules to ensure sensitive ports remain protected\n10. Implement Network Security Group flow logs and traffic analytics for monitoring"
}