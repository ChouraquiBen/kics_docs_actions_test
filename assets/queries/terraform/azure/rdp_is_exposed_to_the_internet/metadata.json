{
  "id": "efbf6449-5ec5-4cfe-8f15-acc51e0d787c",
  "queryName": "RDP Is Exposed To The Internet",
  "severity": "HIGH",
  "category": "Networking and Firewall",
  "descriptionText": "Port 3389 (Remote Desktop) is exposed to the internet",
  "descriptionUrl": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule",
  "platform": "Terraform",
  "descriptionID": "21b8be3f",
  "cloudProvider": "azure",
  "cwe": "732",
  "detailedDescriptionText": "Exposing Remote Desktop Protocol (RDP) port 3389 to the internet creates a high-risk security vulnerability. RDP is a common attack vector used by threat actors to gain unauthorized access to systems through brute force attacks, credential theft, or exploitation of RDP vulnerabilities.\n\nVulnerable examples:\n```terraform\n# Directly exposing port 3389 to the internet with wildcard source\nresource \"azurerm_network_security_rule\" \"vulnerable\" {\n  name                        = \"allow-rdp\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"3389\"  # Vulnerability: RDP port exposed\n  source_address_prefix       = \"*\"     # Vulnerability: Open to any source IP\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n\n# Using internet as source address prefix\nresource \"azurerm_network_security_rule\" \"vulnerable2\" {\n  name                        = \"allow-rdp\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"3389\"       # Vulnerability: RDP port exposed\n  source_address_prefix       = \"internet\"  # Vulnerability: Explicitly allowing internet access\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n\n# Port range that includes 3389\nresource \"azurerm_network_security_rule\" \"vulnerable3\" {\n  name                        = \"allow-ports\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"3388-3390\"  # Vulnerability: Range includes RDP port 3389\n  source_address_prefix       = \"*\"\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n```\n\nSecure examples:\n```terraform\n# Deny RDP from any source\nresource \"azurerm_network_security_rule\" \"secure1\" {\n  name                        = \"deny-rdp\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Deny\"     # Properly denying access\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"3389\"\n  source_address_prefix       = \"*\"\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n\n# Allow RDP only from specific trusted IP address\nresource \"azurerm_network_security_rule\" \"secure2\" {\n  name                        = \"allow-rdp-restricted\"\n  priority                    = 100\n  direction                   = \"Inbound\"\n  access                      = \"Allow\"\n  protocol                    = \"TCP\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"3389\"\n  source_address_prefix       = \"192.168.1.10/32\"  # Specific trusted IP address\n  destination_address_prefix  = \"*\"\n  resource_group_name         = azurerm_resource_group.example.name\n  network_security_group_name = azurerm_network_security_group.example.name\n}\n```\n\nMitigation strategies:\n1. Use Azure Bastion for secure RDP access instead of direct exposure\n2. Implement a VPN or Azure ExpressRoute for secure remote access\n3. If RDP must be exposed, limit access to specific trusted IP addresses only\n4. Enable Network Security Groups with strict inbound security rules\n5. Implement Just-In-Time VM access through Azure Security Center\n6. Use multi-factor authentication for RDP connections\n7. Monitor and audit all RDP access attempts"
}