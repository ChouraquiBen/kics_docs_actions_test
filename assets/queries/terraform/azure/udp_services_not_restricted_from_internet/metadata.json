{
  "id": "a3b4c5d6-e7f8-9012-3456-7890abcdef12",
  "queryName": "Ensure that UDP Services are restricted from the Internet",
  "severity": "HIGH",
  "category": "Networking and Firewall",
  "descriptionText": "NSG rules for UDP traffic must restrict inbound access from the public Internet. Allowing UDP inbound from '0.0.0.0/0' poses significant security risks.",
  "descriptionUrl": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_group",
  "platform": "Terraform",
  "descriptionID": "a3b4c5d6",
  "cloudProvider": "azure",
  "cwe": "284",
  "detailedDescriptionText": "Allowing unrestricted UDP traffic from the internet creates a significant security vulnerability in Azure Network Security Groups (NSGs). Unlike TCP, UDP is a connectionless protocol without built-in handshake mechanisms, making it more susceptible to spoofing and amplification attacks. Open UDP ports can be exploited for DDoS attacks, unauthorized access, and data exfiltration.\n\nVulnerable examples:\n```terraform\n# Security rule directly within NSG allowing unrestricted UDP access\nresource \"azurerm_network_security_group\" \"vulnerable1\" {\n  name                = \"bad-nsg\"\n  location            = \"East US\"\n  resource_group_name = \"example-rg\"\n\n  security_rule {\n    name                       = \"Allow UDP Inbound\"\n    protocol                   = \"udp\"\n    direction                  = \"inbound\"\n    access                     = \"allow\"\n    priority                   = 100\n    source_address_prefix      = \"0.0.0.0/0\"    # Vulnerability: Open to any source IP\n    destination_address_prefix = \"*\"\n    source_port_range          = \"*\"\n    destination_port_range     = \"53\"\n  }\n}\n\n# Standalone security rule allowing unrestricted UDP access\nresource \"azurerm_network_security_rule\" \"vulnerable2\" {\n  name                        = \"Allow UDP Inbound\"\n  resource_group_name         = \"example-rg\"\n  network_security_group_name = \"bad-nsg\"\n  priority                    = 100\n  direction                   = \"inbound\"\n  access                      = \"allow\"\n  protocol                    = \"udp\"\n  source_address_prefix       = \"0.0.0.0/0\"    # Vulnerability: Open to any source IP\n  destination_address_prefix  = \"*\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"53\"\n}\n```\n\nSecure examples:\n```terraform\n# Security rule with restricted source IP range\nresource \"azurerm_network_security_group\" \"secure1\" {\n  name                = \"good-nsg\"\n  location            = \"East US\"\n  resource_group_name = \"example-rg\"\n\n  security_rule {\n    name                       = \"Allow UDP Inbound\"\n    protocol                   = \"udp\"\n    direction                  = \"inbound\"\n    access                     = \"allow\"\n    priority                   = 100\n    source_address_prefix      = \"192.168.1.0/24\"    # Secure: Restricted IP range\n    destination_address_prefix = \"*\"\n    source_port_range          = \"*\"\n    destination_port_range     = \"53\"\n  }\n}\n\n# Standalone security rule with restricted source IP range\nresource \"azurerm_network_security_rule\" \"secure2\" {\n  name                        = \"Allow UDP Inbound\"\n  resource_group_name         = \"example-rg\"\n  network_security_group_name = \"good-nsg\"\n  priority                    = 100\n  direction                   = \"inbound\"\n  access                      = \"allow\"\n  protocol                    = \"udp\"\n  source_address_prefix       = \"192.168.1.0/24\"    # Secure: Restricted IP range\n  destination_address_prefix  = \"*\"\n  source_port_range           = \"*\"\n  destination_port_range      = \"53\"\n}\n```\n\nMitigation strategies:\n1. Restrict UDP traffic to known, trusted IP addresses or CIDR ranges\n2. Implement Azure DDoS Protection Standard for additional safeguards\n3. Use Azure Firewall or Application Gateway as an additional security layer\n4. Consider blocking UDP traffic entirely if not required for your application\n5. Implement Network Virtual Appliances (NVAs) for advanced traffic inspection\n6. Regularly audit NSG rules and remove unnecessary UDP access\n7. Use Azure Network Watcher to monitor suspicious traffic patterns\n8. Enable flow logs and traffic analytics for better visibility and threat detection"
}
